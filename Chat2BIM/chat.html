<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <style type="text/css">
        .container {
            background-color: #0b141a;
            width: 100%;
            margin: 0;
            height: 91%;
            position: fixed;
        }

        .header {
            width: 100%;
            background-color: #65696f;
            text-align: center;
            font-family: Arial;
            height: 5%;
        }

        h1 {
            margin: 0;
        }

        body {
            background-color: #202123;
            color: white;
            margin: 0;
            font-size: large;
        }

        .submitarea {
            bottom: 0;
            width: 100%;
            position: fixed;
            margin: 0;
            height: 5%;
            vertical-align: middle;
            background-color: #0b141a;
        }

        .input {
            width: 93%;
            height: 30px;
            vertical-align: middle;
            margin: 0px 0% 0px 1%;
        }

        .button {
            background: url(/Assets/send.png) no-repeat;
            background-size: 30px;
            border: hidden;
            width: 50px;
            height: fit-content;
        }

        img {
            width: 30px;
            height: 30px;
            vertical-align: middle;
            margin-right: -37px;
        }

        .own-message {
            right: 0;
            width: 95%;
            margin-left: auto;
            margin-right: 0;
            max-width: 95%;
            word-wrap: break-word
        }

            .own-message p {
                width: fit-content;
                max-width: 95%;
                background-color: #005c4b;
                margin-left: auto;
                margin-right: 5px;
                padding: 2px;
                border-radius: 5px;
            }

        .foreign-message {
            left: 0;
            width: 95%;
            max-width: 100%;
            margin-left: 0;
            margin-right: auto;
            max-width: 95%;
            word-wrap: break-word
        }

            .foreign-message p {
                width: fit-content;
                max-width: 95%;
                background-color: #444654;
                margin-left: 5px;
                margin-right: auto;
                padding: 2px;
                border-radius: 5px;
            }
    </style>
</head>
<body>
    <div class="header">
        <h1>ChatToBIM</h1>

    </div>
    <div class="container" id="chatarea">
        <!--<input type="text" id="message" />-->
        <!--<input type="button" id="sendmessage" value="send" >-->
        <!--<input type="hidden" id="displayname" />-->
        <!--<ul id="discussion">-->
        <!--</ul>-->
        <div class="own-message">
            <p>Testmessage</p>
        </div>
        <div class="foreign-message">
            <p>server message</p>
        </div>

    </div>
    <div class="submitarea">
        <input type="text" id="message" class="input" />

        <img src="Assets/send.png" id="sendmessage" />
    </div>
    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-3.4.1.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
            $(function () {
                // Declare a proxy to reference the hub.
                var chat = $.connection.chatbotHub;



                // Create a function that the hub can call to broadcast messages.
                /*chat.client.broadcastMessage = function (name, message) {
                    // Html encode display name and message.
                    var encodedName = $('<div />').text(name).html();
                    var encodedMsg = $('<div />').text(message).html();
                    // Add the message to the page.
                    $('#discussion').append('<li><strong>' + encodedName
                        + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
                };
                */
                chat.client.ClientReceive = function (time, message) {
                    var encodedMsg = $('<div />').text(message).html();

                    var divForeignMessage = document.createElement("div");
                    divForeignMessage.className = "foreign-message";
                    var pForeignMessage = document.createElement("p");
                    pForeignMessage.textContent = encodedMsg;
                    divForeignMessage.appendChild(pForeignMessage);
                    $('#chatarea').append(divForeignMessage);

                };
                chat.client.ClientOwnReceive = function (time, message) {
                    var encodedMsg = $('<div />').text(message).html();

                    var divOwnMessage = document.createElement("div");
                    divOwnMessage.className = "own-message";
                    var pOwnMessage = document.createElement("p");
                    pOwnMessage.textContent = encodedMsg;
                    divOwnMessage.appendChild(pOwnMessage);
                    $('#chatarea').append(divOwnMessage);

                };
                
                // Set initial focus to message input box.
                $('#message').focus();
                // Start the connection.
                $.connection.hub.start().done(function () {
                    $('#sendmessage').click(function () {

                        // Call the receive method on the hub.
                        chat.server.receive($('#message').val());
                        chat.server.openbim();
                        // Clear text box and reset focus for next comment.
                        $('#message').val('').focus();
                    });
                });
            });
    </script>
</body>
</html>